<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Track your habits and quits with this simple self-hosted app">
    
    <!-- PWA meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Habit Tracker">
    <link rel="apple-touch-icon" href="/images/icon-192.png">
</head>
<body>
    <div id="app">
        <!-- Loading state -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Authentication forms -->
        <div id="auth-container" class="auth-container" style="display: none;">
            <div class="auth-card">
                <h1>Habit Tracker</h1>
                <p class="subtitle">Track your habits and quits</p>
                
                <!-- Login Form -->
                <form id="login-form" class="auth-form">
                    <h2>Sign In</h2>
                    <div class="input-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" name="username" required>
                    </div>
                    <div class="input-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                    <p class="auth-switch">
                        Don't have an account? 
                        <a href="#" id="show-register">Create one</a>
                    </p>
                </form>

                <!-- Register Form -->
                <form id="register-form" class="auth-form" style="display: none;">
                    <h2>Create Account</h2>
                    <div class="input-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" name="username" required>
                    </div>
                    <div class="input-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" name="password" required>
                    </div>
                    <div class="input-group">
                        <label for="register-password-confirm">Confirm Password</label>
                        <input type="password" id="register-password-confirm" name="password-confirm" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Account</button>
                    <p class="auth-switch">
                        Already have an account? 
                        <a href="#" id="show-login">Sign in</a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Main app -->
        <div id="main-app" class="main-app" style="display: none;">
            <!-- Header with Tabs -->
            <header class="app-header">
                <div class="header-content">
                    <h1>Habit Tracker</h1>
                    <div class="header-menu">
                        <button class="header-menu-trigger" id="header-menu-btn">‚ãØ</button>
                        <div class="header-dropdown" id="header-dropdown" style="display: none;">
                            <button class="header-menu-item" id="add-activity-btn">
                                ‚ûï Add Activity
                            </button>
                            <button class="header-menu-item" id="settings-btn">
                                ‚öôÔ∏è Settings
                            </button>
                            <button class="header-menu-item" id="logout-btn">
                                üö™ Logout
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Tabs in Header -->
                <div class="header-tabs">
                    <div class="activity-tabs">
                        <button class="tab-button active" data-tab="habits">
                            <span class="tab-icon">‚úÖ</span>
                            Habits
                            <span class="tab-count" id="habits-count">0</span>
                        </button>
                        <button class="tab-button" data-tab="quits">
                            <span class="tab-icon">üö´</span>
                            Quits
                            <span class="tab-count" id="quits-count">0</span>
                        </button>
                        <button class="tab-button" data-tab="logs">
                            <span class="tab-icon">üìã</span>
                            Logs
                            <span class="tab-count" id="logs-count">0</span>
                        </button>
                    </div>
                    
                    <!-- View Toggle Buttons -->
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" data-view="cards" title="Card View">
                            <span class="view-icon">‚äû</span>
                        </button>
                        <button class="view-toggle-btn" data-view="table" title="Table View">
                            <span class="view-icon">‚â°</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main content -->
            <main class="main-content">
                <!-- Activities Grid -->
                <section class="activities-section">
                    
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <div id="habits-tab" class="tab-pane active">
                            <div id="habits-grid" class="activities-grid">
                                <!-- Habit activities will be loaded here -->
                            </div>
                            <div id="habits-table" class="activities-table" style="display: none;">
                                <!-- Habit activities table will be loaded here -->
                            </div>
                            <div id="no-habits" class="no-activities" style="display: none;">
                                <p>No habits yet. Create your first habit!</p>
                                <button class="btn btn-primary add-habit-btn">+ Add Habit</button>
                            </div>
                        </div>
                        
                        <div id="quits-tab" class="tab-pane">
                            <div id="quits-grid" class="activities-grid">
                                <!-- Quit activities will be loaded here -->
                            </div>
                            <div id="quits-table" class="activities-table" style="display: none;">
                                <!-- Quit activities table will be loaded here -->
                            </div>
                            <div id="no-quits" class="no-activities" style="display: none;">
                                <p>No quits yet. Create your first quit!</p>
                                <button class="btn btn-primary add-quit-btn">+ Add Quit</button>
                            </div>
                        </div>
                        
                        <div id="logs-tab" class="tab-pane">
                            <div class="logs-content">
                                <h3>Today's Activity</h3>
                                <div id="today-events" class="today-events">
                                    <!-- Today's events will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Add Activity Modal -->
        <div id="activity-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">Add Activity</h2>
                    <button id="close-modal" class="close-btn">&times;</button>
                </div>
                <form id="activity-form" class="activity-form">
                    <div class="input-group">
                        <label for="activity-name">Name</label>
                        <input type="text" id="activity-name" name="name" required placeholder="e.g., Drink Water, Exercise">
                    </div>
                    <div class="input-group">
                        <label for="activity-type">Type</label>
                        <select id="activity-type" name="type" required>
                            <option value="">Select type...</option>
                            <option value="habit">Habit (something you want to do)</option>
                            <option value="quit">Quit (something you want to stop)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="activity-icon">Icon (optional)</label>
                        <input type="text" id="activity-icon" name="icon" placeholder="e.g., üíß, üèÉ, üö≠">
                    </div>
                    <div class="input-group">
                        <label for="activity-color">Color</label>
                        <input type="color" id="activity-color" name="color" value="#6366f1">
                    </div>
                    <div class="input-group" id="abstinence-text-group" style="display: none;">
                        <label for="activity-abstinence-text">
                            Custom Time Label
                            <span class="label-hint">(e.g., "Clean for", "Smoke-free for")</span>
                        </label>
                        <div class="input-with-edit">
                            <input type="text" id="activity-abstinence-text" name="abstinenceText"
                                   placeholder="Abstinence time" disabled>
                            <button type="button" id="edit-abstinence-text" class="edit-btn" title="Edit custom text">‚úèÔ∏è</button>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancel-modal" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Activity</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Retroactive Slip-up Modal -->
        <div id="slipup-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="slipup-modal-title">Log Slip-up</h3>
                    <button type="button" id="close-slipup-modal" class="close-btn">&times;</button>
                </div>
                <form id="slipup-form">
                    <div class="input-group">
                        <label for="slipup-date">Date</label>
                        <input type="date" id="slipup-date" name="date" required readonly>
                    </div>
                    <div class="input-group">
                        <label for="slipup-time">Time</label>
                        <input type="time" id="slipup-time" name="time" required>
                    </div>
                    <div class="input-group">
                        <label for="slipup-notes">Notes (optional)</label>
                        <textarea id="slipup-notes" name="notes" placeholder="What happened? How are you feeling?" rows="3"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancel-slipup-modal" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Log Slip-up</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Day Entries Modal -->
        <div id="day-entries-modal" class="modal" style="display: none;">
            <div class="modal-content day-entries-modal">
                <div class="day-entries-header">
                    <h3 id="day-entries-title">Entries for <span id="day-entries-date"></span></h3>
                    <button type="button" id="close-day-entries" class="close-btn">&times;</button>
                </div>
                <div id="day-entries-list" class="day-entries-list">
                    <!-- Entries will be populated here -->
                </div>
                <div class="day-entries-footer">
                    <button type="button" id="add-new-entry-btn" class="add-new-entry-btn">Add New Entry</button>
                </div>
            </div>
        </div>

        <!-- API Key Display Modal -->
        <div id="api-key-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>New API Key Generated</h3>
                    <button type="button" id="close-api-key-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <p class="warning-message">‚ö†Ô∏è Save this key now! It will only be shown once.</p>
                    <div class="api-key-display">
                        <code id="api-key-value"></code>
                        <button class="btn btn-secondary" id="copy-api-key-btn">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Documentation Modal -->
        <div id="api-docs-modal" class="modal" style="display: none;">
            <div class="modal-content api-docs-content">
                <div class="modal-header">
                    <h3>API Documentation</h3>
                    <button type="button" id="close-api-docs-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body api-docs-body">
                    <h4>Authentication</h4>
                    <p>Include your API key in the request headers:</p>
                    <pre><code>X-API-Key: hqt_your_api_key_here</code></pre>
                    <p>Or use Authorization header:</p>
                    <pre><code>Authorization: Bearer hqt_your_api_key_here</code></pre>

                    <h4>Base URL</h4>
                    <pre><code id="api-base-url"></code></pre>

                    <h4>Endpoints</h4>

                    <div class="api-endpoint">
                        <h5>Get Activities</h5>
                        <code>GET /api/activities</code>
                        <p>Returns all your habits and quits</p>
                    </div>

                    <div class="api-endpoint">
                        <h5>Create Activity</h5>
                        <code>POST /api/activities</code>
                        <pre><code>{
  "name": "Drink Water",
  "type": "habit",
  "color": "#6366f1",
  "icon": "üíß"
}</code></pre>
                    </div>

                    <div class="api-endpoint">
                        <h5>Log Event</h5>
                        <code>POST /api/events</code>
                        <pre><code>{
  "activity_id": "activity-uuid",
  "note": "Optional note",
  "timestamp": "2024-01-01T12:00:00Z"
}</code></pre>
                    </div>

                    <div class="api-endpoint">
                        <h5>Get Events</h5>
                        <code>GET /api/events?activity_id=uuid</code>
                        <p>Query parameters: activity_id, limit, offset, today</p>
                    </div>

                    <div class="api-endpoint">
                        <h5>Delete Event</h5>
                        <code>DELETE /api/events/:id</code>
                    </div>

                    <h4>Example with curl</h4>
                    <pre><code>curl -H "X-API-Key: hqt_your_key" \
     https://yoursite.com/api/activities</code></pre>

                    <h4>Example with JavaScript</h4>
                    <pre><code>fetch('https://yoursite.com/api/activities', {
  headers: {
    'X-API-Key': 'hqt_your_key',
    'Content-Type': 'application/json'
  }
})
.then(res => res.json())
.then(data => console.log(data))</code></pre>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="settings-modal" style="display: none;">
            <div class="settings-modal-content">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <button id="close-settings" class="settings-close-btn">&times;</button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <h3>Account</h3>
                        <div class="settings-item">
                            <label>Username</label>
                            <div class="settings-value" id="settings-username">Loading...</div>
                        </div>
                        <div class="settings-item">
                            <label>Change Password</label>
                            <button class="btn btn-secondary" id="change-password-btn">Change Password</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Preferences</h3>
                        <div class="settings-item">
                            <label>Default Abstinence Text
                                <span class="label-hint">Used for all new quit activities</span>
                            </label>
                            <div class="settings-input-group">
                                <input type="text" id="default-abstinence-text" class="settings-input" placeholder="e.g., Clean for, Sober for">
                                <button class="btn btn-primary btn-sm" id="save-abstinence-text">Save</button>
                                <button class="btn btn-secondary btn-sm" id="restore-abstinence-default" title="Restore to system default">Restore Default</button>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>App Title
                                <span class="label-hint">Customize the application title</span>
                            </label>
                            <div class="settings-input-group">
                                <input type="text" id="custom-title" class="settings-input" placeholder="e.g., My Tracker, Daily Goals">
                                <button class="btn btn-primary btn-sm" id="save-custom-title">Save</button>
                                <button class="btn btn-secondary btn-sm" id="restore-title-default" title="Restore to system default">Restore Default</button>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>Title Bar Visibility
                                <span class="label-hint">Show or hide the title section</span>
                            </label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="show-title-section" checked>
                                    <span>Show Title Section</span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>Tab Visibility
                                <span class="label-hint">Choose which tabs to display</span>
                            </label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="show-habits-tab" checked>
                                    <span>Show Habits Tab</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="show-quits-tab" checked>
                                    <span>Show Quits Tab</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="show-logs-tab" checked>
                                    <span>Show Logs Tab</span>
                                </label>
                            </div>
                            <div id="tab-visibility-error" class="error-message" style="display: none; color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem;">
                                At least one of Habits or Quits tabs must be visible
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>Theme</label>
                            <select id="theme-select" class="settings-select">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="ocean">Ocean</option>
                                <option value="custom">Custom Themes...</option>
                            </select>
                        </div>
                        <div class="settings-item">
                            <label>Time Zone</label>
                            <select id="timezone-select" class="settings-select">
                                <option value="auto">Auto-detect</option>
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time</option>
                                <option value="America/Chicago">Central Time</option>
                                <option value="America/Denver">Mountain Time</option>
                                <option value="America/Los_Angeles">Pacific Time</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>API Access</h3>
                        <div class="settings-item">
                            <label>API Keys</label>
                            <button class="btn btn-primary" id="create-api-key-btn">Generate New API Key</button>
                        </div>
                        <div id="api-keys-list" class="api-keys-list">
                            <!-- API keys will be loaded here -->
                        </div>
                        <div class="settings-item">
                            <label>Documentation</label>
                            <button class="btn btn-secondary" id="view-api-docs-btn">View API Documentation</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Data Management</h3>
                        <div class="settings-item">
                            <label>Export Data</label>
                            <button class="btn btn-secondary" id="export-data-btn">Export to JSON</button>
                        </div>
                        <div class="settings-item">
                            <label>Delete All Data</label>
                            <button class="btn btn-danger" id="delete-all-data-btn">Delete Everything</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>About</h3>
                        <div class="settings-item">
                            <label>Version</label>
                            <div class="settings-value">1.0.0</div>
                        </div>
                        <div class="settings-item">
                            <label>Source Code</label>
                            <div class="settings-value">
                                <a href="https://github.com/yourusername/habit-tracker" target="_blank">View on GitHub</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div id="message-container" class="message-container"></div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>